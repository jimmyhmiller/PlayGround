<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebGPU Renderer - Full Feature Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
            text-align: center;
            background: linear-gradient(90deg, #60a5fa, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .subtitle {
            margin: 0 0 20px 0;
            font-size: 14px;
            color: #94a3b8;
            text-align: center;
        }
        canvas {
            border: 2px solid #334155;
            border-radius: 8px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: block;
            margin-bottom: 20px;
        }
        #status {
            padding: 12px 24px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        .features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
            max-width: 1100px;
        }
        .feature {
            padding: 16px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            border: 1px solid #334155;
        }
        .feature h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #60a5fa;
        }
        .feature ul {
            margin: 0;
            padding-left: 20px;
            font-size: 13px;
            line-height: 1.6;
            color: #cbd5e1;
        }
    </style>
</head>
<body>
    <h1>WebGPU Renderer</h1>
    <div class="subtitle">Full Feature Demonstration: SDF Rendering, Gradients, Borders, Patterns & More</div>
    <canvas id="canvas" width="1100" height="800"></canvas>
    <div id="status">Initializing...</div>

    <div class="features">
        <div class="feature">
            <h3>‚ú® Rendering Features</h3>
            <ul>
                <li>Signed Distance Field (SDF) rendering</li>
                <li>Smooth anti-aliasing</li>
                <li>Rounded corners (per-corner control)</li>
                <li>Clipping & content masks</li>
            </ul>
        </div>
        <div class="feature">
            <h3>üé® Backgrounds</h3>
            <ul>
                <li>Solid colors (HSLA)</li>
                <li>Linear gradients (any angle)</li>
                <li>Radial gradients</li>
                <li>Conic (angular) gradients</li>
                <li>sRGB & Oklab color spaces</li>
            </ul>
        </div>
        <div class="feature">
            <h3>üî≤ Borders</h3>
            <ul>
                <li>Per-side border widths</li>
                <li>Solid & dashed border styles</li>
                <li>Border colors (HSLA)</li>
                <li>Borders with rounded corners</li>
            </ul>
        </div>
        <div class="feature">
            <h3>üé≠ Patterns</h3>
            <ul>
                <li>Diagonal stripes (any angle)</li>
                <li>Dots (anti-aliased)</li>
                <li>Checkerboard</li>
                <li>Grid lines</li>
            </ul>
        </div>
    </div>

    <script type="module">
        import { WebGPURenderer } from './src/renderer/webgpu-renderer.js';
        import { Scene, Quad, Background } from './src/core/primitives.js';
        import { Bounds, Point, Size, Corners, Edges, Hsla } from './src/core/geometry.js';

        async function runDemo() {
            const canvas = document.getElementById('canvas');
            const statusEl = document.getElementById('status');

            try {
                const renderer = new WebGPURenderer(canvas);
                await renderer.initialize();

                const scene = new Scene();

                // Canvas size for content mask
                const canvasSize = new Bounds(new Point(0, 0), new Size(1100, 800));

                // === HEADER: Simple solid color test ===
                const header = new Quad();
                header.bounds = new Bounds(new Point(50, 30), new Size(1000, 80));
                header.background = Background.Solid(Hsla.rgb(0.9, 0.2, 0.3, 1)); // Red
                header.cornerRadii = Corners.uniform(20);
                header.borderWidths = Edges.uniform(3);
                header.borderColor = Hsla.rgb(0.95, 0.4, 0.5, 1);
                header.contentMask.bounds = canvasSize;
                scene.insertQuad(header);

                // === ROW 1: Blue quad test ===
                const linearGrad = new Quad();
                linearGrad.bounds = new Bounds(new Point(50, 130), new Size(320, 200));
                linearGrad.background = Background.Solid(Hsla.rgb(0.2, 0.4, 0.9, 1)); // Blue
                linearGrad.cornerRadii = Corners.uniform(16);
                linearGrad.borderWidths = Edges.uniform(4);
                linearGrad.borderColor = Hsla.rgb(0.8, 0.5, 0.2, 0.8);
                linearGrad.contentMask.bounds = canvasSize;
                scene.insertQuad(linearGrad);

                // === ROW 1: Gradient test (exact copy from index.html) ===
                const radialGrad = new Quad();
                radialGrad.bounds = new Bounds(new Point(390, 130), new Size(320, 200));
                radialGrad.background = Background.LinearGradient(45, [
                    { color: Hsla.rgb(0.2, 0.5, 0.9, 1), position: 0 },
                    { color: Hsla.rgb(0.8, 0.3, 0.6, 1), position: 1 }
                ], 0);
                radialGrad.cornerRadii = Corners.uniform(15);
                radialGrad.borderWidths = Edges.uniform(3);
                radialGrad.borderColor = Hsla.rgb(0.1, 0.2, 0.4, 1);

                radialGrad.contentMask.bounds = canvasSize;
                scene.insertQuad(radialGrad);

                // === ROW 1: Conic Gradient (Oklab) ===
                const conicGrad = new Quad();
                conicGrad.bounds = new Bounds(new Point(730, 130), new Size(320, 200));
                conicGrad.background = Background.ConicGradient(
                    0.5, 0.5, 0,  // center x, y, start angle
                    [
                        { color: Hsla.rgb(0.6, 0.4, 0.95, 1), position: 0 },
                        { color: Hsla.rgb(0.95, 0.4, 0.7, 1), position: 1 }
                    ],
                    1  // Oklab
                );
                conicGrad.cornerRadii = Corners.uniform(16);
                conicGrad.borderWidths = Edges.uniform(4);
                conicGrad.borderColor = Hsla.rgb(0.8, 0.4, 0.9, 0.8);

                conicGrad.contentMask.bounds = canvasSize;
                scene.insertQuad(conicGrad);

                // === ROW 2: Patterns ===
                // Diagonal stripes
                const stripes = new Quad();
                stripes.bounds = new Bounds(new Point(50, 350), new Size(230, 180));
                stripes.background = Background.Pattern(
                    45,  // angle
                    Hsla.rgb(1, 1, 1, 1),  // color1 (white)
                    Hsla.rgb(0.3, 0.5, 0.9, 1),  // color2
                    18,  // spacing
                    0  // diagonal stripes
                );
                stripes.cornerRadii = Corners.uniform(12);
                stripes.borderWidths = Edges.uniform(3);
                stripes.borderColor = Hsla.rgb(0.2, 0.4, 0.8, 1);
                stripes.borderStyle = 1; // Dashed

                stripes.contentMask.bounds = canvasSize;
                scene.insertQuad(stripes);

                // Dots pattern
                const dots = new Quad();
                dots.bounds = new Bounds(new Point(300, 350), new Size(230, 180));
                dots.background = Background.Pattern(
                    0,  // angle
                    Hsla.rgb(1, 1, 1, 1),  // color1 (white)
                    Hsla.rgb(0.9, 0.6, 0.2, 1),  // color2
                    22,  // spacing
                    1  // dots
                );
                dots.cornerRadii = Corners.uniform(12);
                dots.borderWidths = Edges.uniform(3);
                dots.borderColor = Hsla.rgb(0.8, 0.5, 0.1, 1);

                dots.contentMask.bounds = canvasSize;
                scene.insertQuad(dots);

                // Checkerboard
                const checkerboard = new Quad();
                checkerboard.bounds = new Bounds(new Point(550, 350), new Size(230, 180));
                checkerboard.background = Background.Pattern(
                    0,
                    Hsla.rgb(0.95, 0.95, 0.95, 1),
                    Hsla.rgb(0.25, 0.25, 0.25, 1),
                    30,
                    2  // checkerboard
                );
                checkerboard.cornerRadii = Corners.uniform(12);
                checkerboard.borderWidths = Edges.uniform(3);
                checkerboard.borderColor = Hsla.rgb(0.15, 0.15, 0.15, 1);

                checkerboard.contentMask.bounds = canvasSize;
                scene.insertQuad(checkerboard);

                // Grid pattern
                const grid = new Quad();
                grid.bounds = new Bounds(new Point(800, 350), new Size(250, 180));
                grid.background = Background.Pattern(
                    0,
                    Hsla.rgb(1, 1, 1, 1),
                    Hsla.rgb(0.4, 0.8, 0.3, 1),
                    35,
                    3  // grid
                );
                grid.cornerRadii = Corners.uniform(12);
                grid.borderWidths = Edges.uniform(3);
                grid.borderColor = Hsla.rgb(0.3, 0.7, 0.2, 1);

                grid.contentMask.bounds = canvasSize;
                scene.insertQuad(grid);

                // === ROW 3: Pills with borders ===
                const pill1 = new Quad();
                pill1.bounds = new Bounds(new Point(50, 550), new Size(200, 70));
                pill1.background = Background.Solid(Hsla.rgb(0.95, 0.85, 0.95, 1));
                pill1.cornerRadii = Corners.uniform(35);
                pill1.borderWidths = Edges.uniform(5);
                pill1.borderColor = Hsla.rgb(0.9, 0.4, 0.8, 1);

                pill1.contentMask.bounds = canvasSize;
                scene.insertQuad(pill1);

                const pill2 = new Quad();
                pill2.bounds = new Bounds(new Point(270, 550), new Size(200, 70));
                pill2.background = Background.Solid(Hsla.rgb(0.85, 0.92, 0.95, 1));
                pill2.cornerRadii = Corners.uniform(35);
                pill2.borderWidths = Edges.uniform(5);
                pill2.borderColor = Hsla.rgb(0.3, 0.7, 0.9, 1);
                pill2.borderStyle = 1; // Dashed

                pill2.contentMask.bounds = canvasSize;
                scene.insertQuad(pill2);

                const pill3 = new Quad();
                pill3.bounds = new Bounds(new Point(490, 550), new Size(200, 70));
                pill3.background = Background.Solid(Hsla.rgb(0.88, 0.95, 0.85, 1));
                pill3.cornerRadii = Corners.uniform(35);
                pill3.borderWidths = Edges.uniform(8);
                pill3.borderColor = Hsla.rgb(0.4, 0.8, 0.3, 1);

                pill3.contentMask.bounds = canvasSize;
                scene.insertQuad(pill3);

                // Circles with radial gradients
                const circle1 = new Quad();
                circle1.bounds = new Bounds(new Point(730, 550), new Size(70, 70));
                circle1.background = Background.RadialGradient(
                    0.5, 0.5, 0.8,
                    [
                        { color: Hsla.rgb(1, 0.7, 0.7, 1), position: 0 },
                        { color: Hsla.rgb(0.9, 0.2, 0.2, 1), position: 1 }
                    ],
                    0
                );
                circle1.cornerRadii = Corners.uniform(35);
                circle1.borderWidths = Edges.uniform(4);
                circle1.borderColor = Hsla.rgb(0.8, 0.1, 0.1, 1);

                circle1.contentMask.bounds = canvasSize;
                scene.insertQuad(circle1);

                const circle2 = new Quad();
                circle2.bounds = new Bounds(new Point(820, 550), new Size(70, 70));
                circle2.background = Background.RadialGradient(
                    0.5, 0.5, 0.8,
                    [
                        { color: Hsla.rgb(0.7, 0.7, 1, 1), position: 0 },
                        { color: Hsla.rgb(0.2, 0.2, 0.9, 1), position: 1 }
                    ],
                    0
                );
                circle2.cornerRadii = Corners.uniform(35);
                circle2.borderWidths = Edges.uniform(4);
                circle2.borderColor = Hsla.rgb(0.1, 0.1, 0.8, 1);

                circle2.contentMask.bounds = canvasSize;
                scene.insertQuad(circle2);

                const circle3 = new Quad();
                circle3.bounds = new Bounds(new Point(910, 550), new Size(70, 70));
                circle3.background = Background.RadialGradient(
                    0.5, 0.5, 0.8,
                    [
                        { color: Hsla.rgb(0.7, 1, 0.7, 1), position: 0 },
                        { color: Hsla.rgb(0.2, 0.9, 0.2, 1), position: 1 }
                    ],
                    0
                );
                circle3.cornerRadii = Corners.uniform(35);
                circle3.borderWidths = Edges.uniform(4);
                circle3.borderColor = Hsla.rgb(0.1, 0.8, 0.1, 1);

                circle3.contentMask.bounds = canvasSize;
                scene.insertQuad(circle3);

                // === ROW 4: Large complex cards ===
                const card1 = new Quad();
                card1.bounds = new Bounds(new Point(50, 640), new Size(480, 130));
                card1.background = Background.Pattern(
                    0,
                    Hsla.rgb(1, 1, 1, 1),
                    Hsla.rgb(0.75, 0.5, 0.9, 1),
                    20,
                    1  // dots
                );
                card1.cornerRadii = Corners.uniform(20);
                card1.borderWidths = Edges.uniform(6);
                card1.borderColor = Hsla.rgb(0.7, 0.4, 0.85, 1);

                card1.contentMask.bounds = canvasSize;
                scene.insertQuad(card1);

                const card2 = new Quad();
                card2.bounds = new Bounds(new Point(550, 640), new Size(500, 130));
                card2.background = Background.LinearGradient(
                    45,
                    [
                        { color: Hsla.rgb(0.5, 0.8, 0.9, 1), position: 0 },
                        { color: Hsla.rgb(0.6, 0.7, 0.95, 1), position: 1 }
                    ],
                    1  // Oklab
                );
                card2.cornerRadii = Corners.uniform(20);
                card2.borderWidths = new Edges(3, 3, 10, 3);  // Asymmetric
                card2.borderColor = Hsla.rgb(0.4, 0.7, 0.9, 1);

                card2.contentMask.bounds = canvasSize;
                scene.insertQuad(card2);

                console.log('=== WebGPU Renderer - Full Feature Demo ===');
                console.log('Rendering scene demonstrating:');
                console.log('  ‚úì SDF-based rounded corners');
                console.log('  ‚úì Linear, radial, and conic gradients');
                console.log('  ‚úì sRGB and Oklab color spaces');
                console.log('  ‚úì Solid and dashed borders');
                console.log('  ‚úì Pattern rendering (stripes, dots, checkerboard, grid)');
                console.log('  ‚úì Anti-aliased edges');

                // Render the scene
                renderer.render(scene);

                statusEl.textContent = `‚úì SUCCESS: Rendered full feature set`;
                console.log('‚úì Demo completed successfully');
            } catch (error) {
                statusEl.textContent = `‚ùå FAILED: ${error.message}`;
                console.error('Demo failed:', error);
                console.error(error.stack);
            }
        }

        runDemo();
    </script>
</body>
</html>
