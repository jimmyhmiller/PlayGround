# Test: multi-line paste should not lock up
# Sends a large multi-line input in a single send_input action
# and verifies all lines are echoed back promptly.

name = "multiline_paste"
description = "Pasting multiple lines should echo back without locking up"
timeout_secs = 10

[command]
program = "cat"

[[actions]]
type = "attach"

# Send a large multi-line paste in one shot
[[actions]]
type = "send_input"
text = "line 1\nline 2\nline 3\nline 4\nline 5\nline 6\nline 7\nline 8\nline 9\nline 10\nline 11\nline 12\nline 13\nline 14\nline 15\nline 16\nline 17\nline 18\nline 19\nline 20\n"

# Verify all lines arrived
[[actions]]
type = "wait_for_output"
contains = "line 20"
timeout_secs = 3

# Send EOF
[[actions]]
type = "send_bytes"
bytes = [4]

[[actions]]
type = "wait_for_exit"
expected_code = 0
timeout_secs = 5

[expected_final_state]
daemon_alive = false
