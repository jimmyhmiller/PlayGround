extern fn read_file(path: String) -> String;
extern fn arg_str(index: I64) -> String;
extern fn print_int(v: I64) -> I64;

fn count_coloncolon(list: TokenList) -> I64 {
    let one: I64 = 1;
    let zero: I64 = 0;
    match list {
        TokenList::Nil {} => zero,
        TokenList::Cons { head, tail } => {
            let rest: I64 = count_coloncolon(tail);
            match head.kind {
                TokenKind::ColonColon {} => one + rest,
                _ => rest,
            }
        }
    }
}

fn count_sym_colon(list: TokenList) -> I64 {
    let one: I64 = 1;
    let zero: I64 = 0;
    let colon: I64 = 58;
    match list {
        TokenList::Nil {} => zero,
        TokenList::Cons { head, tail } => {
            let rest: I64 = count_sym_colon(tail);
            match head.kind {
                TokenKind::Sym { code: c } => if c == colon { one + rest } else { rest },
                _ => rest,
            }
        }
    }
}

fn main() -> I64 {
    let path: String = arg_str(0);
    let src: String = read_file(path);
    let toks: TokenList = lex_list(src);
    let cc: I64 = count_coloncolon(toks);
    let c: I64 = count_sym_colon(toks);
    let _a: I64 = print_int(cc);
    let _b: I64 = print_int(c);
    let zero: I64 = 0;
    zero
}
