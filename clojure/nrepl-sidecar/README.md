# nrepl-sidecar

An nREPL middleware that sends all requests and responses to a sidecar server for monitoring and debugging.

## Usage

Add this middleware to your nREPL configuration:

```clojure
(require '[sidecar.nrepl-sidecar :refer [wrap-sidecar]])

;; Add to your middleware stack
(nrepl.server/start-server
  :port 7888
  :middleware [#'wrap-sidecar])
```

Or add to your `~/.lein/profiles.clj`:

```clojure
{:user {:dependencies [[sidecar/nrepl-sidecar "0.1.0"]]
        :repl-options {:nrepl-middleware [sidecar.nrepl-sidecar/wrap-sidecar]}}}
```

## Configuration

The sidecar server URL defaults to `http://localhost:8888`. You can configure it by binding the dynamic var:

```clojure
(binding [sidecar.nrepl-sidecar/*sidecar-url* "http://your-server:9999"]
  ;; your nREPL usage here
  )
```

## Sidecar Server

The middleware sends JSON payloads to your sidecar server with this structure:

### Request
```json
{
  "type": "request",
  "timestamp": 1693123456789,
  "session": "session-id",
  "id": "msg-id",  
  "op": "eval",
  "message": {...}
}
```

### Response
```json
{
  "type": "response",
  "timestamp": 1693123456790,
  "session": "session-id",
  "id": "msg-id",
  "op": "eval",
  "response": {...}
}
```

## Fault Tolerance

If the sidecar server is not available, all requests are silently ignored with a 1-second timeout.

## Development

Run the project's tests:

    $ clojure -T:build test

Build a JAR:

    $ clojure -T:build ci

Install locally:

    $ clojure -T:build install

Deploy to Clojars:

    $ clojure -T:build deploy

## License

Copyright Â© 2025 Jimmyhmiller

_EPLv1.0 is just the default for projects generated by `clj-new`: you are not_
_required to open source this project, nor are you required to use EPLv1.0!_
_Feel free to remove or change the `LICENSE` file and remove or update this_
_section of the `README.md` file!_

Distributed under the Eclipse Public License version 1.0.
