struct Atom {
    value
}

// TODO: When I have namespaces
// these won't be prefix named

fn deref(atom) {
    // assert!(atom is Atom)
    primitive_deref(atom)
}

fn swap!(atom, f) {
    // assert!(atom is Atom)
    primitive_swap!(atom, f)
}

fn reset!(atom, value) {
    // assert!(atom is Atom)
    primitive_reset!(atom, value)
}

fn compare_and_swap!(atom, old, new) {
    // assert!(atom is Atom)
    primitive_compare_and_swap!(atom, old, new)
}

fn main() {
    let atom = Atom { value: 42 }
    println(atom)
    reset!(atom, 1)
    println(atom)
    swap!(atom, fn(x) { x + 1 })
    println(atom)
    let x = deref(atom)
    println(x)
    "done!"
}